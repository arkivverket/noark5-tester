Klargjør kravet om bruk av CORS i REST-API-et
=============================================

 ------------------  ---------------------------------
           Prosjekt  NOARK 5 Tjenestegresesnitt
           Kategori  Versjon 1.0 beta
        Alvorlighet  protest
       Meldingstype  utelatt
    Brukerreferanse  pere@hungry.com
        Dokumentdel  4
         Sidenummer  9
        Linjenummer  n/a
    Innsendingsdato  ikke sendt inn
 ------------------  ---------------------------------

Denne teksten er del av en samling innspill til NOARK5-standarden
tilgjengelig fra [https://github.com/petterreinholdtsen/noark5-tester/](https://github.com/petterreinholdtsen/noark5-tester/).

Beskrivelse
-----------

Spesifikasjonens vedlegg 1 (konformitetskrav) på side 267 referer til
[http://rel.kxml.no/noark5/konformitetsniva/](http://rel.kxml.no/noark5/konformitetsniva/)
som inneholder foreløpig liste med konformitetsnivå.  Websiden lister
opp CORS Cross-origin resource sharing som et nivå 0-krav.  Men W3Cs CORS
nevnes ikke med et ord i spesifikasjonen.


CORS bør dermed nevnes i spesifikasjonen, og den bør forklare nærmere
hvilke krav som gjelder relatert til CORS, deriblant hvilken versjon
av CORS som kreves.  I skrivende stund er siste utgave datert
2014-01-16.  Demonstrasjonsimplementasjonen tilgjengelig fra
http://n5test.kxml.no/api/ støtter ikke HTTP-forespørselen OPTIONS,
hvilket er en forutsetning for at CORS skal fungere.  Det er dermed
vanskelig å finne ut hva som er tenkt rundt bruken av CORS i
tjenestegrensesnittet.  For eksemepel, skal innlogging endre hvilke
operasjoner som vises i hodefeltet Access-Control-Allow-Methods eller?
Dvs. at kun de som får lov til å slette en entitet får se at 'DELETE'
er støttet.  I så fall bør det nevnes i spesifikasjonen at hodefeltet
Authenticate alltid skal være satt når CORS brukes.  Det er dog uklart
om dette vil fungere, da nettlesere kan gjøre sine CORS-kall uavhengig
av eventuell innlogging registrert av en JavaScript-klient.


Et relatert spørsmål når det gjelder er om GET- og HEAD-responsene
alltid skal ha med Allow-hodefeltet definert i [IETF RFC
2616](https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) som
forklarer hvilke operasjoner brukeren har tilgang til å bruke?  Det
blir enklere for en API-klient hvis Allow-feltet er satt og korrekt
også for GET- og HEAD-responsene.  Det er kanskje greiere å
implemntere at OPTIONS ikke krever innlogging og returnerer alle
mulige operasjoner for alle brukere, mens GET og HEAD returnerer de
operasjonene som er mulig med gjeldende innlogging.

Ønsket endring
--------------

Det bør legges inn en beskrivelse enten under punkt 4 (Teknologi)
eller punkt 6 (Konsepter og Prinsipper) som forklarer hva som
forventes fra API-et når det gjelder CORS, samt referanse til aktuell
CORS-spesifikasjon.

FIXME bedre og/eller mer konkret tekstforslag?

> Tjenestegrensesnittet skal støtte CORS (Cross-Origin Resource
> Sharing) slik det er beskrevet på https://www.w3.org/TR/cors/ .
> Dette betyr at alle lenker skal støtte OPTIONS-forespørsler uten
> innlogging der alle mulige operasjoner returneres i
> Access-Control-Allow-Methods.
> 
> Alle GET- og HEAD-forespørsler skal returnere lovlige operasjoner i
> HTTP-hodefeltet Allow.
